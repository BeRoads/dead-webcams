<!DOCTYPE html>
<html>
  <head>
    <title>BeRoads - Dead webcams</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .opacity50 {

  filter:alpha(opacity=50);

  -moz-opacity:0.3;

  -khtml-opacity: 0.3;

  opacity: 0.3;

}
  </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="header">
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#">About</a></li>
        </ul>
        <h3 class="text-muted">BeRoads - Dead webcams</h3>
      </div>
      <br />
      <div class="jumbotron">
        <h1>Dead webcams, dead webcams everywhere ...</h1>
        <p class="lead">It's been a long time since we started playing with highway webcams
        feeds at BeRoads and as we were building the API we clearly saw that a lot of webcams
        are broken down, unavailable or not up to date. So we build this website in the hope
        that the government will do something.</p>
      </div>
      <div id="general"></div>
      <div class="footer">
        <p>Build with the BeRoads API and data <3</p>
      </div>

    </div> <!-- /container -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="./bootstrap/js/bootstrap.min.js"></script>
    <script>
      //TODO : expand/append zone elements on click so we don't overflow the page 
      $.getJSON("http://data.beroads.com/IWay/Camera.json",
       function(data){
        var total = data.Camera.item.length;
        var enabled = 0;

        var zones = {};
        $.each(data.Camera.item, function(i,item){
          if(item.enabled == "1")
            enabled++;
          if(zones[item.zone] == undefined)
            zones[item.zone] = {
              'total' : 0,
              'enabled' : 0,
              'webcams' : []
            };

          zones[item.zone]['total']++;
          zones[item.zone]['webcams'].push(item);
          if(item.enabled==true)
            zones[item.zone]['enabled']++;

       });

        var html = "";
        $.each(zones, function(i, zone){
          var percentage = Math.round((zone['enabled']/zone['total'])*100);
          html += '<div class="col-lg-12"><h1>'+i+'  <small>';
          if(percentage==100)
            html+= '<span class="pull-right label label-success">'+percentage+' %</span>';
          else if(percentage >= 50) {
            html+= '<span class="pull-right label label-warning">'+percentage+' %</span>'; 
          }
          else {
            html+= '<span class="pull-right label label-danger">'+percentage+' %</span>';
          }
          html += "</small></h1><br />";
          
          html += '<div class="row">';
  
          $.each(zone['webcams'], function(j, webcam) {
            html += '<div class="col-sm-2 col-md-2"><div class="thumbnail">';
            html += "<img src='"+webcam.img+"' ";
            if(!webcam.enabled){
              html += " class='opacity50' ";
            }
            html += " />";
            html += '<div class="caption">';
            html += '<p>'+webcam.city+'</p>';
            html += '</div></div></div>';
          });

          html += '</div></div><hr />';
        });

        $('#general').html(html);
      });


    </script>
  </body>
</html>

